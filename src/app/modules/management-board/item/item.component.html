<div class="item-wrapper">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="m-0">Items</h4>
    <button class="btn btn-primary btn-sm" (click)="openAddModal()">
      + Add Item
    </button>
  </div>

  <app-table
    [columns]="tableColumns"
    [data]="items"
    [showIndex]="true"
    [emptyMessage]="'No items available.'"
    (action)="onTableAction($event)"
  >
    <ng-template #actionsTemplate ngProjectAs="actionsTemplate" let-row>
      <div class="action-buttons">
        <button class="btn btn-warning btn-sm" (click)="openEditModal(row)" type="button" title="Edit">
          <i class="bi bi-pencil-square"></i>
        </button>

        <button class="btn btn-danger btn-sm" (click)="openDeleteConfirm(row.id)" type="button" title="Delete">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </ng-template>
  </app-table>
</div>

<div id="itemModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h5>{{ itemForm.get('id')?.value ? 'Update Item' : 'Add Item' }}</h5>
      <button class="close" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="itemForm">
        <div class="form-group">
          <label>Name</label>
          <input class="form-control" formControlName="name">
          <small class="text-danger" *ngIf="itemForm.get('name')?.touched && itemForm.get('name')?.invalid">
            Required (max 20 chars)
          </small>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea rows="3" class="form-control" formControlName="description"></textarea>
        </div>

        <div class="form-group">
          <label>Price</label>
          <input type="number" class="form-control" formControlName="price">
        </div>

        <div class="form-group">
          <label>Categories</label>
          <app-multi-select
            [options]="categories"
            optionLabel="name"
            optionValue="id"
            formControlName="categoryIds">
          </app-multi-select>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary btn-sm" (click)="closeModal()">Close</button>
      <button class="btn btn-primary btn-sm" [disabled]="itemForm.invalid" (click)="saveItem()">
        {{ itemForm.get('id')?.value ? 'Update' : 'Save' }}
      </button>
    </div>
  </div>
</div>

<app-confirm-popup
  [show]="showDeletePopup"
  title="Delete Item"
  message="Are you sure you want to delete this item?"
  (confirm)="confirmDelete()"
  (cancel)="cancelDelete()">
</app-confirm-popup>
